var ContentSwap=(function(h){var c={debug:false};var n={pageId:"",contentDomWrapper:"",controlRepository:null,controlInventory:null,enableControls:true,langpref:""};function i(s){var p=[];if(s.length>0){for(var r=0,q=s.length;r<q;r++){if(l(s[r])==="object"){if(s[r].wrapperId){n.contentDomWrapper=s[r].wrapperId}else{if(s[r].pageId){n.pageId=s[r].pageId}else{if(s[r].lang){p.push(s[r])}}}}}n.controlInventory=p;if(!c.debug){m()}else{o()}}}function o(){var q=n.controlInventory;var p,w;if(h("#inPageControls",n.contentDomWrapper).length==0){p=h('<div id="inPageControls"></div>');w=h('<div id="langControlsWrapper"><h2>page language: </h2></div>')}var v,t;var u=h('<ul id="langControls"></ul>');for(var s=0,r=q.length;s<r;s++){v=q[s].lang;t=q[s].content;h("<li></li>").append(h("<a></a>",{href:"",id:v+"Control","class":"langButton",text:v,data:{xmlsrc:t},click:a})).appendTo(h(u))}h(w).append(h(u));h(p).append(h(w)).prependTo(n.contentDomWrapper);e()}function e(){if(n.langpref){if(h("#"+n.langpref+"Control").length>0){h("#"+n.langpref+"Control").click()}else{alert("language: "+n.langpref+" | doesn't match any of the supported languages.")}}else{h("#EnglishControl").click()}}function b(p){h.ajax({url:"persist.asp",cache:false,data:"langpref="+p,success:function(q){}})}function m(){h.ajax({url:"persist.asp",cache:false,success:function(p){n.langpref=p;o()}})}function a(q){q.preventDefault();if(n.enableControls&&n.controlRepository!=h(this).attr("id")){n.enableControls=false;h(this).toggleClass("current");var r=h(this).attr("id");var p=h(this).data("xmlsrc");if(n.controlRepository){d()}g(p,r)}}function d(){if(h(n.contentDomWrapper+" object").length>0){var p;h(n.contentDomWrapper+" object").each(function(){p=h(this).attr("id");swfobject.removeSWF(p)})}h("#"+n.controlRepository).toggleClass("current");h(n.contentDomWrapper+" #markup").add(n.contentDomWrapper+" #narrationwrapper").remove()}function g(p,q){h.ajax({url:p,success:function(t,u){var r;if(l(t)==="string"){r=h.parseXML(t)}else{if(l(t)==="object"){r=t}}var s=h(r);k(s,q)}})}function k(x,F){var u=x.find("page#"+n.pageId);var p;if(h("#markup #narrationwrapper",u).length>0){$narrWrapper=h("#markup #narrationwrapper",u).detach();var t=$narrWrapper.get(0);var G=f(t);if(G){h(n.contentDomWrapper+" #inPageControls").append(G)}if(h(n.contentDomWrapper+" #narrationwrapper a.cc").length==1){h(n.contentDomWrapper+" #narrationwrapper a.cc").click(function(I){I.preventDefault();h(n.contentDomWrapper+" #narrationwrapper #narrationtranscript").toggle("fast")})}}var r=h("#markup",u).get(0);var v=f(r);if(v){h(n.contentDomWrapper).append(v)}if(h("flash",u).length>0){var D,y,E,H,B,z,w;var C={};var A={};var q={};h("flash",u).each(function(){B=h(this);D=B.attr("targetelement");y={width:B.attr("width"),height:B.attr("height")};if(h("pathtoasset",B).length>0){var I={};h("pathtoasset",B).each(function(){y.data=h(this).text()})}if(h("param",B).length>0){h("param",B).each(function(){z=h(this);E=h("key:first",z).text();H=h("val:first",z).text();q[E]=H;h.extend(C,q)})}if(h("flashvar",B).length>0){h("flashvar",B).each(function(){w=h(this);E=h("key:first",w).text();H=h("val:first",w).text();q[E]=H;h.extend(A,q)})}j(D,C,y,A);A=C=q={}})}n.controlRepository=F;var s=h("content",x).attr("language");b(s);if(l(h.contentLoadedCallback)==="function"){h.contentLoadedCallback()}n.enableControls=true}function j(p,v,u,t){var s=jQuery.param(t);var q=u;var r={menu:"false",flashvars:s};if(v){h.extend(r,v)}var w=p;swfobject.createSWF(q,r,w)}function l(q){var p=typeof q;if(p==="object"){if(q){if(q instanceof Array){p="array"}}else{p="null"}}return p}function f(p){if(l(p.xml)!="undefined"){return p.xml}else{if(l(window.XMLSerializer)!="undefined"){return(new window.XMLSerializer()).serializeToString(p)}}return""}return{init:function(){i(arguments)},destroy:function(){d();n.pageId="";n.contentDomWrapper="";n.controlRepository=null;n.controlInventory=null;n.enableControls=true;n.langpref=""},setDebugBool:function(p){c.debug=p}}})(jQuery);