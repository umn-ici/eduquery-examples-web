var MultiMatch=function(d){var c=false;var e=false;var b;var a={init:function(j){j.addClass("multimatch_ui");var o=d("dt",j);var h=d("dl",j);var l=d("dd",j);var n=-1;var k;var i;var g=0;var m=0;var f=0;l.hide();o.each(function(){d(this).wrapInner('<a href="#"></a>')});o.each(function(p){m++;d(this).next("dd").each(function(){var s=d(this);var q=s.find(".cor").length;var r;s.find("span.correct_statement").each(function(){d(this).remove()});if(c){s.find("span.itemfeedback").each(function(){r=d(this).remove()})}else{s.find("span.itemfeedback").each(function(){d(this).remove()})}s.prev("dt").data("questionInfo",{id:p,hiding:true,feedback:r,isComplete:false,total_correct:q,user_correct:0})})});h.on("click.DT","dt a",function(p){p.preventDefault();var r=d(this).parent();var q=r.next("dd");r.toggleClass("hasUserFocus");q.addClass("hasUserFocus").slideToggle(300);k=r.data("questionInfo").id;h.find("dt").each(function(){var s=d(this);if(s.data("questionInfo").id!=k){s.removeClass("hasUserFocus");s.next("dd").removeClass("hasUserFocus");if(!s.data("questionInfo").isComplete){s.next("dd").slideUp(300)}}});r.next("dd").each(function(){d(this).find("ul.ansArea li").each(function(){var s=d(this);if(d("a",s).length==0){var t=s.html();s.empty();s.append('<a href="#">'+t+"</a>")}})})});h.on("click.DD","dd a",function(u){u.preventDefault();var q=d(this);var x=q.closest("dd").prev("dt");var p=x.data("questionInfo").total_correct;var v;var t=q.parent().parent().parent();var s=q.parent().parent().parent().find("ul.feedback li");if(d(this).parent().hasClass("rightans")||d(this).parent().hasClass("wrongans")){return false}var r=q.closest("li");if(r.hasClass("cor")){q.parent().addClass("rightans");q.parent().addClass("bold").animate({"font-size":"1.2em"},300);x.data("questionInfo").user_correct++;v=x.data("questionInfo").user_correct;if(p>1&&v<p){if(s.text().length>0){s.hide(300).empty()}else{s.hide(300)}s.append("Good Job, there are other answers as well").delay(300).show(300)}if(v===p){f++;t.animate({opacity:0},300,function(){q.parents("dd").addClass("isComplete").prev("dt").addClass("isComplete").data("questionInfo").isComplete=true;d(this).find("ul.ansArea li").each(function(){if(!d(this).hasClass("rightans")&&!d(this).hasClass("wrongans")){d(this).slideUp()}d(this).css({"font-size":".7em",margin:0});if(d(this).hasClass("rightans")){d(this).css("font-size","1em")}d(this).children().contents().unwrap('<a href="#"></a>')});t.delay(300).animate({opacity:1},300)});t.prev("dt").animate({opacity:0},300,function(){d(this).css({"font-size":"1em"});d(this).find("a").contents().unwrap('<a href="#"></a>');d(this).delay(300).animate({opacity:1},300)});if(c){s.animate({opacity:0},300,function(){s.empty().append(t.prev("dt").data("questionInfo").feedback).delay(300).animate({"font-size":"1em",opacity:1},300)})}else{t.find("ul.feedback li").hide(500)}if(e&&(f===m)){h.find("dt").removeClass("hasUserFocus");h.find("dd").removeClass("hasUserFocus");$feedback_dialogue=d('<div class="feedback_dialogue"><div class="feedback_body fb_win" tabindex="0">'+b+'</div><div class="feedback_control"><a href="#">Close feedback</a></div></div>');var w=d(".multimatch_ui").height();$feedback_dialogue.height(w);d(".feedback_control",$feedback_dialogue).on("click.Matching","a",function(y){y.preventDefault();$feedback_dialogue.hide()});j.append($feedback_dialogue)}}}else{r.addClass("wrongans");if(s.text().length>0){s.hide(300).empty()}s.append("There are better answers.").delay(300).show(300)}})},final_feedback_set:function(f){e=true;b=f}};return{init:function(f){a.init(f)},feedback:function(){c=true},final_feedback:function(f){a.final_feedback_set(f)}}}(jQuery);