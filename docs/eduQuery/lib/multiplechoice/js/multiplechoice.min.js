/*! All rights reserved Research and Training Center on Community Living (RTC) at the University of Minnesota (rtcweb@umn.edu) */
/*! Author : Shawn Lawler */
var MultipleChoice=function(){this.$ansarea_select_hint=$('<div class="ansarea_select_hint hidden"></div>'),this.settings={showAll:!1,transition_length:500,msg_correct:"Correct! - Answer the next question.",msg_fail:"Incorrect. Give it another try!",msg_win:"Congratulations, you've completed this exercise!"},this.bin={q_count:0,$curGroup:""}};MultipleChoice.prototype.init=function(a,b){b&&$.extend(this.settings,b);var c=this.settings.showAll;this.$container=a.addClass("multiplechoice_ui").attr({role:"region","aria-label":"Multiple-choice interactive exercise. Please use the highest (beginner) verbosity setting in your screen reading software."}),this.$kb=this.$container.find(".mc_knowledgebank"),this.$q_groups=this.$container.find(".mc_kb_group"),this.$message=$(".message",this.$container),this.bottomAnchorId=this.$container.attr("id")+"BottomAnchor",this.$container.append('<div id="'+this.bottomAnchorId+'" tabindex="0" class="hidden">You&rsquo;re at the end / bottom of the multiple choice interaction.</div>'),this.$message.addClass("msg_default"),this.$q_groups.each(function(a){var b=$(this).find("h3"),c="group"+a,d="Question "+(a+1);$(this).attr({role:"region","aria-label":d}),b.wrapInner('<span class="q_text">'),b.attr("id",c).prepend('<span class="q_num">'+(a+1)+"</span>")}),$("li",this.$q_groups).each(function(a){var b=$(this);$(".answer_type",b).empty();var d,c=b.html();d=b.hasClass("mc_item_correct")?$('<a href="" class="mc_ans_correct" role="button">'+c+"</a>"):$('<a href="" role="button">'+c+"</a>"),b.html(d)}),this.$q_groups.each(function(a){var b=$(this);c||a>0&&b.addClass("inactive"),b.data("questionData",{id:a,usePath:[]});var d=$(".feedback",b);1==d.length&&(b.data("questionData").feedback=d.text(),d.detach())}),this.answersBind()},MultipleChoice.prototype.answersBind=function(){var a="";this.$q_groups.on("click.MultipleChoice, keydown.MultipleChoice","ul > li > a",$.proxy(function(b){if("keydown"==b.type&&13!=b.which&&32!=b.which)return!0;b.preventDefault();var c=!1,d=$(b.target),e=d.closest("li");this.bin.$curGroup=d.closest(".mc_kb_group");e.hasClass("mc_item_correct")?(e.addClass("indicator_correct"),c=!0,a=this.settings.msg_correct):(e.addClass("indicator_incorrect"),a=this.settings.msg_fail),e.attr("data-feedback")&&(a=e.attr("data-feedback")),d.append('<span class="feedback"><span class="strong_meh">(</span>'+a+'<span class="strong_meh">)</span></span>'),d.parent().addClass("mc_answered");var g=d.html();if(d.replaceWith('<span class="highlite">'+g+"</span>"),c){this.bin.q_count++;var h="";this.$q_groups.length==this.bin.q_count?(h=$('<span class="hidden">You have answered the last question in this exercise <a href="">Use this shortcut link to skip back to the top of the interaction where you&rsquo;ll find a final message and be able to review your answers.</a></span>'),this.message("win")):(h='<span class="hidden"> Use your <strong>down-arrow key</strong> to move to the next question region.</span>',this.questionTransitionOut()),e.find(".feedback").append(h).find("a").eq(0).bind("click.MultipleChoice, keydown.MultipleChoice",$.proxy(function(a){a.preventDefault(),this.$message.find("h1").focus()},this))}e.attr("tabindex","0"),e.focus()},this))},MultipleChoice.prototype.questionTransitionOut=function(){var a=this.bin.$curGroup;a.animate({"padding-top":".3em","padding-bottom":".5em"},600),$(".q_text",a).animate({"font-size":".9em"},600);var b=$(".mc_answered",a).not(".mc_item_correct");b.length>0&&b.animate({"font-size":".8em"},600);var c=$("li",a).not(".mc_answered");c.length>0?c.hide(600,$.proxy(function(){this.questionComplete(a)},this)):this.questionComplete(a)},MultipleChoice.prototype.questionComplete=function(a){if($("li",a).not(".mc_answered").remove(),this.$q_groups.length==this.bin.q_count)a.addClass("mc_knowledge");else{var b=a.data("questionData").id+1,c=this.$q_groups.eq(b);this.settings.showAll?(c.removeClass("inactive"),a.addClass("mc_knowledge")):window.setTimeout(function(){$(".q_text, ul",c).show(500,function(){c.removeClass("inactive"),a.addClass("mc_knowledge")})},100)}},MultipleChoice.prototype.message=function(a){var b="";"win"==a&&(this.$message.addClass("msg_win"),b=this.settings.msg_win+' <span class="hidden">Use your <strong>arrow keys</strong> to review the questions and your responses below <em>or</em> <a href="">Use this shortcut link to skip to the bottom of this interaction</a>.</span>',this.$message.on("click.MultipleChoice, keydown.MultipleChoice","a",$.proxy(function(a){a.preventDefault(),this.$container.find("#"+this.bottomAnchorId).focus()},this)),this.$kb.parent().animate({"padding-top":"4.5em"},700)),$("h1",this.$message).html(b),this.questionTransitionOut()},MultipleChoice.prototype.setMessage=function(a,b){"correct"==a?this.settings.msg_correct=b:"fail"==a?this.settings.msg_fail=b:"win"==a&&(this.settings.msg_win=b)};