/*! Copyright College of Direct Support */
var MultipleChoice=function(){this.$container,this.$kb,this.$q_groups,this.$message;this.$ansarea_select_hint=$('<div class="ansarea_select_hint hidden"></div>');this.settings={showAll:false,transition_length:500,msg_correct:"Correct! - Answer the next question.",msg_fail:"Incorrect. Give it another try!",msg_win:"Congratulations, you've completed this exercise!"};this.bin={q_count:0,"$curGroup":""}};MultipleChoice.prototype.init=function(a,b){if(b){$.extend(this.settings,b)}var c=this.settings.showAll;this.$container=a.addClass("multiplechoice_ui");this.$kb=this.$container.find(".mc_knowledgebank");this.$q_groups=this.$container.find(".mc_kb_group");this.$message=$(".message",this.$container);this.$message.addClass("msg_default");$("h3",this.$q_groups).each(function(d){var e=$(this);e.wrapInner('<span class="q_text">');e.attr("id","group"+d).prepend('<span class="q_num">'+(d+1)+"</span>")});$("li",this.$q_groups).each(function(d){var g=$(this);$(".answer_type",g).empty();var f=g.html();var e;if(g.hasClass("mc_item_correct")){e=$('<a href="" class="mc_ans_correct">'+f+"</a>")}else{e=$('<a href="">'+f+"</a>")}g.html(e)});this.$q_groups.each(function(d){var f=$(this);if(!c){if(d>0){f.addClass("inactive")}}f.data("questionData",{id:d,usePath:[]});var e=$(".feedback",f);if(e.length==1){f.data("questionData").feedback=e.text();e.detach()}});this.answersBind()};MultipleChoice.prototype.answersBind=function(){var a="";this.$q_groups.on("click.MultipleChoice","a",$.proxy(function(i){i.preventDefault();var b,d,h=false,g=$(i.target),c=g.closest("li"),f=this.bin.$curGroup=g.closest(".mc_kb_group");if(c.hasClass("mc_item_correct")){c.addClass("indicator_correct");h=true;a=this.settings.msg_correct}else{c.addClass("indicator_incorrect");a=this.settings.msg_fail}if(c.attr("data-feedback")){a=c.attr("data-feedback")}g.append('<span class="feedback"><span class="strong_meh">(</span>'+a+'<span class="strong_meh">)</span></span>');f.data("questionData").usePath.push(g.text().replace(/^\s+|\s+$/g,""));g.parent().addClass("mc_answered");d=g.html();g.replaceWith('<span class="highlite">'+d+"</span>");if(h){this.bin.q_count++;if(this.$q_groups.length==this.bin.q_count){this.message("win")}else{this.questionTransitionOut()}}},this))};MultipleChoice.prototype.questionTransitionOut=function(){var a,c,b=this.bin.$curGroup;b.animate({"padding-top":".3em","padding-bottom":".5em"},600);$(".q_text",b).animate({"font-size":".9em"},600);c=$(".mc_answered",b).not(".mc_item_correct");if(c.length>0){c.animate({"font-size":".8em"},600)}a=$("li",b).not(".mc_answered");if(a.length>0){a.hide(600,$.proxy(function(){this.questionComplete(b)},this))}else{this.questionComplete(b)}};MultipleChoice.prototype.questionComplete=function(b){var a,c;$("li",b).not(".mc_answered").remove();if(this.$q_groups.length==this.bin.q_count){b.addClass("mc_knowledge")}else{a=b.data("questionData").id+1;c=this.$q_groups.eq(a);if(!this.settings.showAll){window.setTimeout(function(){$(".q_text, ul",c).show(500,function(){c.removeClass("inactive");b.addClass("mc_knowledge")})},100)}else{c.removeClass("inactive");b.addClass("mc_knowledge")}}};MultipleChoice.prototype.message=function(b){var a="";this.$message.slideUp(200,$.proxy(function(){if(b=="win"){this.$message.addClass("msg_win");a=this.settings.msg_win;this.$kb.parent().animate({"padding-top":"4.5em"},700)}$("h1",this.$message).html(a);this.$message.slideDown(500,$.proxy(function(){this.$message.focus();this.questionTransitionOut()},this))},this))};MultipleChoice.prototype.setMessage=function(b,a){if(b=="correct"){this.settings.msg_correct=a}else{if(b=="fail"){this.settings.msg_fail=a}else{if(b=="win"){this.settings.msg_win=a}}}};